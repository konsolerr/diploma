Реализация RBlock
----------

На данный момент Rblock представляет из себя один пакет, который можно установить стандартными средствами языка R. Укажем, какие именно датасеты, алгоритмы и представления были реализованы, и укажем ссылки на листинги в приложении.

Кроме того были реализованы некоторые примитивы для поддержания валидности логов исполнения, для того, чтобы возвращать корректный исполняемый код.


### Gene Expression Dataset ###

Прежде всего в ходе работы был реализован датасет для хранения данных о генетической экспрессии. Части реализации которые мы рассмотрим:

* Конструктор
* Построение тепловой карты
* Построение дифференциальной экспрессии
* метод showKnit

Конструктор принимает аргументами два файла: 

* Файл содержащий данные экспресии в формате tsv
* Файл содержащий аннотацию в формате tsv

Данные экспрессии представляют из себя таблицу, в которой строками являются строковые или числовые идентификаторы генов, а столбцами являются идентификаторы образцов. Элементы таблицы -- числовые характеристики экспрессии.

Файл аннотации также представляет из себя таблицу, первый столбец которой -- образец (sample), а остальные столбцы именуются специалистом и по сути являются именами отдельных аннотаций. Аннотация по своей сути есть разбиение всего множества образцов на меньшие множества образцов схожими друг с другом некоторыми общими условиями.
 
Конструктор проверяет являются ли данные в файле логарифмированными/нормализованными и при необходимости логарифмирует/нормирует данные. На данном этапе данные аннотации просто прикрепляются к датасету. Метод возвращает объект класса GeneExpressionDataset.

Метод построения тепловой карты принимает три аргумента:

* Название аннотации (из файла аннотации), которую использовать при отображении датасета
* Число n -- количество генов, которые будут отображены на тепловой карте.
* Число k -- количество кластеров в кластеризации k-мерами.

Данный метод подготавливает данные для построения тепловой карты. Он выбирает n строк таблицы экспрессии с максимальной мерой, затем кластеризует их k-мерами и возвращает объект класса-представления HeatMap.

Метод построения дифференциальной экспрессии принимает три аргумента:

* Выбранная аннотация
* Элемент множества выбранной аннотации
* Элемент множества выбранной аннотации

Данный метод строит датасет дифференциальной экспрессии. Здесь мы пользуемся библиотекой limma из библиотеки Bioconductor для построения дифференциальной экспрессии генов, сравнивая два разных набора из аннотации. Данный метод возвращает объект класса DifferentialExpressionDataSet.

Метод showKnit возвращает html-представление датасета, содержащее:

* Количество строк
* Идентификаторы образцов
* Был ли датасет логарифмирован/нормализован


Реализацию можно смотреть в приложении на листинге 1.


### HeatMap Presentation ###

Единственный реализованный метод этого представления -- метод showKnit, он возвращает html-представление тепловой карты. В нашем случае это html содержащий графическое представление тепловой карты с выбранной аннотацией. На \inlref{рисунке}{img:MyHeatmap} продемонстрирована теплокарта -- результат выполнения метода showKnit.

\image{MyHeatmap}{Построенное представления класса HeatMap}


### Differential Expression Dataset ###

В ходе работы был реализован датасет для хранения данных о дифференциальной экспрессии. Методы которые мы рассмотрим:

* Посмотреть верхушку значений
* Добавить к таблице имена в соответствии с Entrez
* метод showKnit


Метод просмотра верхушки таблицы принимает два аргумента:

* Строковый параметр определяющий, что мы ищем (максимум или минимум) и в каком столбце таблицы дифференциальной экспрессии.
* Число n -- количество значений верхушки/низа таблицы.

Данный метод ищет n максимальных/минимальных по значению выбранного столбца строк таблицы дифференциальной экспрессии и возвращает объект класса Stat.

Метод добавления к таблице имён в соответствии с Entrez не принимает аргументов и возвращает новый объект класса DifferentialExpressionDataset с новым столбцом symbol, со строковыми представлениями имени гена соответствующих EntRez.

Метод showKnit не принимает аргументов и возвращает html-представление первых 20 строк таблицы, отсортированной по B-статистике.

### Stat Presentation ###

Единственный реализованный метод этого представления -- метод showKnit, он возвращает html-представление примитива data.frame языка R.

### Поддержание корректности log ###

Поддержание корректности поля log интерфейсов Dataset и Presentation является важной составляющей реализации этих интерфейсов. В во всех реализованных классах мы применили следующий подход: сначала генерировали и собирали код, необходимый для создания датасета/представления, затем выполняли его. Этот же самый код мы дописывали в поле log. Таким образом достигается точное соответствие между реальными объектами языка R и исполняемым кодом, которым может скачать пользователь сервиса. Воспроизводимость исследования достигнута.

