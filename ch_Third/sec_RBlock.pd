Реализация RBlock
----------

На данный момент RBlock представляет из себя один файл, содержащий R-код. Данный файл оборачивается в пакет, который можно установить стандартными средствами языка R. Укажем, какие именно датасеты, алгоритмы и представления были реализованы.

Кроме того были реализованы некоторые примитивы для поддержания валидности логов исполнения, для того, чтобы возвращать корректный исполняемый код.


### Gene Expression Dataset ###

Прежде всего в ходе работы был реализован датасет для хранения данных о генетической экспрессии. Части реализации которые мы рассмотрим:

1. конструктор;
2. построение тепловой карты;
3. построение дифференциальной экспрессии;
4. метод showKnit.

Конструктор принимает аргументами два файла: 

1. файл содержащий данные экспресии в формате tsv;
2. файл содержащий аннотацию в формате tsv.

Данные экспрессии представляют из себя таблицу, в которой строки соответствуют строковым или числовым идентификаторам генов, а столбцы соответствуют идентификаторам образцов. Элементы таблицы -- числовые характеристики экспрессии.

Файл аннотации также представляет из себя таблицу, первый столбец которой -- образец (sample), а остальные столбцы именуются специалистом и по сути являются именами отдельных аннотаций. Аннотация по своей сути есть разбиение всего множества образцов на меньшие множества образцов схожими друг с другом некоторыми общими условиями.
 
Конструктор проверяет являются ли данные в файле логарифмированными/нормализованными и при необходимости логарифмирует/нормализует данные. На данном этапе аннотации просто прикрепляются к датасету. Метод возвращает объект класса GeneExpressionDataset.

Метод построения тепловой карты принимает три аргумента:

1. Название аннотации (из файла аннотации), которую использовать при отображении датасета;
2. Число n -- число генов, которые будут отображены на тепловой карте;
3. Число k -- число кластеров в кластеризации k-means.

Данный метод подготавливает данные для построения тепловой карты. Он выбирает n строк таблицы экспрессии с максимальной медианой, затем кластеризует их k-мерами и возвращает объект класса-представления HeatMap.

Метод построения дифференциальной экспрессии принимает три аргумента:

1. Выбранная аннотация;
2. Первый элемент множества для сравнения из множества выбранной аннотации;
3. Второй элемент множества для сравнения из множества выбранной аннотации.

Данный метод строит датасет дифференциальной экспрессии. Здесь используется библиотекой limma (из библиотеки Bioconductor) для построения дифференциальной экспрессии генов, сравнивая два разных набора образцов. Данный метод возвращает объект класса DifferentialExpressionDataSet.

Метод showKnit возвращает html-представление датасета, содержащее:

1. Количество строк;
2. Идентификаторы образцов;
3. Был ли датасет логарифмирован/нормализован.




### HeatMap Presentation ###

Метод showKnit этого представления возвращает html-представление тепловой карты. В нашем случае это html содержащий изображение тепловой карты с выбранной аннотацией. На \inlref{рисунке}{img:MyHeatmap} продемонстрирована тепловая карта -- результат выполнения метода showKnit.

\image{MyHeatmap}{Пример построенного представления класса HeatMap для GeneExpressionDataset.}


### Differential Expression Dataset ###

В ходе работы был реализован датасет для хранения данных о дифференциальной экспрессии. Методы которые мы рассмотрим:

1. Посмотреть верхних значений таблицы;
2. Добавить к таблице имена в соответствии с базами данных Entrez (The Entrez Global Query Cross-Database Search System -- поисковая система, позволяющая проивзодить поиск внутри баз данных National Center for Biotechnological Information -- национальный центр биотехнологической информации США);
3. Метод showKnit.


Метод просмотра верхних значений таблицы принимает два аргумента:

1. Строковый параметр определяющий, что мы ищем (максимум или минимум) и в каком столбце таблицы дифференциальной экспрессии, например параметр "-P.value" означает брать первые значения из таблицы, отсортированной по убыванию значения P.Value, а "+B" означает брать первые значения из таблицы, отсортированной по возрастанию значения B-статистики анализа дифференциальной экспресии;
2. Число n -- число верхних/нижних строк таблицы.

Данный метод ищет n максимальных/минимальных по значению выбранного столбца строк таблицы дифференциальной экспрессии и возвращает объект класса Stat.

Метод добавления к таблице имён в соответствии с Entrez не принимает аргументов и возвращает новый объект класса DifferentialExpressionDataset с новым столбцом symbol, со строковыми представлениями имён генов, соответствующих Entrez.

Метод showKnit не принимает аргументов и возвращает html-представление первых 20 строк таблицы, отсортированной по B-статистике анализа дифференциальной экспресии.

Реализация приведена в приложении A на листинге.

### Stat Presentation ###

Единственный реализованный метод этого представления -- метод showKnit, он возвращает html-представление любого примитива языка R.

### Поддержание корректности log ###

Поддержание корректности поля log интерфейсов Dataset и Presentation является важной составляющей реализации этих интерфейсов. В во всех реализованных классах мы применили следующий подход: сначала генерируется код, необходимый для создания датасета/представления, затем это код исполняется. Этот же самый код дописывывается в поле log. Таким образом достигается точное соответствие между реальными объектами языка R и исполняемым кодом, которым может скачать пользователь сервиса. Таким образом достигается воспроизводимость исследования.

